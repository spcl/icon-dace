SUBROUTINE SRTM_INIT(CDIRECTORY, NWVCONTINUUM)

!-- read in the basic coefficients to configure RRTM_SW
!- creates module YOESRTWN with BG, NSPA, NSPB, WAVENUM1, WAVENUM2,
!  DELWAVE, PREF, PREFLOG, TREF

USE PARKIND1  ,ONLY : JPIM , JPRB
USE ecradhook   ,ONLY : LHOOK, DR_HOOK, JPHOOK

USE PARSRTM  , ONLY : JPG, JPSW
USE YOESRTM  , ONLY : NGN
USE YOESRTWN , ONLY : NG, NGM, WT, NGC, RWGT, WTSM
!USE YOESRTWN , ONLY : NG, NGM, WT, NGC, NGN, RWGT, WTSM
!USE YOMLUN   , ONLY : NULOUT

IMPLICIT NONE

CHARACTER(LEN=*), INTENT(IN) :: CDIRECTORY

! Water vapour continuum model (0=default MT_CKD2.5, 1=CAVIAR)
INTEGER(KIND=JPIM), INTENT(IN), OPTIONAL :: NWVCONTINUUM

! Local variables
INTEGER(KIND=JPIM) :: IGC, IGCSM, IBND, IG, IND, IPR, IPRSM
REAL(KIND=JPRB)    :: ZWTSUM

REAL(KIND=JPHOOK) :: ZHOOK_HANDLE

!#include "susrtmcf.intfb.h"
INTERFACE
SUBROUTINE SUSRTM
END SUBROUTINE SUSRTM
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB16(DIRECTORY)
CHARACTER(LEN=*), INTENT(IN) :: DIRECTORY
END SUBROUTINE SRTM_KGB16
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB17
END SUBROUTINE SRTM_KGB17
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB18
END SUBROUTINE SRTM_KGB18
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB19
END SUBROUTINE SRTM_KGB19
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB20
END SUBROUTINE SRTM_KGB20
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB21
END SUBROUTINE SRTM_KGB21
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB22
END SUBROUTINE SRTM_KGB22
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB23
END SUBROUTINE SRTM_KGB23
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB24
END SUBROUTINE SRTM_KGB24
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB25
END SUBROUTINE SRTM_KGB25
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB26
END SUBROUTINE SRTM_KGB26
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB27
END SUBROUTINE SRTM_KGB27
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB28
END SUBROUTINE SRTM_KGB28
END INTERFACE
INTERFACE
SUBROUTINE SRTM_KGB29
END SUBROUTINE SRTM_KGB29
END INTERFACE
!#include "susrtop.intfb.h"

interface
SUBROUTINE MODIFY_WV_CONTINUUM(NWVCONTINUUM)
use parkind1 , only:&
 & jpim
INTEGER(KIND=JPIM), INTENT(IN) :: NWVCONTINUUM
END SUBROUTINE MODIFY_WV_CONTINUUM
end interface

INTERFACE
SUBROUTINE SRTM_CMBGB16
END SUBROUTINE SRTM_CMBGB16
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB17
END SUBROUTINE SRTM_CMBGB17
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB18
END SUBROUTINE SRTM_CMBGB18
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB19
END SUBROUTINE SRTM_CMBGB19
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB20
END SUBROUTINE SRTM_CMBGB20
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB21
END SUBROUTINE SRTM_CMBGB21
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB22
END SUBROUTINE SRTM_CMBGB22
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB23
END SUBROUTINE SRTM_CMBGB23
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB24
END SUBROUTINE SRTM_CMBGB24
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB25
END SUBROUTINE SRTM_CMBGB25
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB26
END SUBROUTINE SRTM_CMBGB26
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB27
END SUBROUTINE SRTM_CMBGB27
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB28
END SUBROUTINE SRTM_CMBGB28
END INTERFACE
INTERFACE
SUBROUTINE SRTM_CMBGB29
END SUBROUTINE SRTM_CMBGB29
END INTERFACE

IF (LHOOK) CALL DR_HOOK('SRTM_INIT',0,ZHOOK_HANDLE)

!CALL SUSRTMCF
CALL SUSRTM

!-- read in the molecular absorption coefficients

CALL SRTM_KGB16(CDIRECTORY)
CALL SRTM_KGB17
CALL SRTM_KGB18
CALL SRTM_KGB19
CALL SRTM_KGB20
CALL SRTM_KGB21
CALL SRTM_KGB22
CALL SRTM_KGB23
CALL SRTM_KGB24
CALL SRTM_KGB25
CALL SRTM_KGB26
CALL SRTM_KGB27
CALL SRTM_KGB28
CALL SRTM_KGB29

IF (PRESENT(NWVCONTINUUM)) THEN
  ! Modify the shortwave water vapour continuum, if requested
  CALL MODIFY_WV_CONTINUUM(NWVCONTINUUM)
END IF

!-- read in the cloud optical properties
!- creates module YOESRTOP with EXTLIQ1, SSALIQ1, ASYLIQ1, 
!  EXTICE3, SSAICE3, ASYICE3, FDLICE3  

!-- RRTM_SW cloud optical properties are not used
!   SRTM_CLDPROP is not called
!   no need to call SUSRTOP

!CALL SUSRTOP ( -1 )


!Mike Iacono 20050804
!-- Perform g-point reduction from 16 per band (224 total points) to
!-- a band dependent number (112 total points) for all absorption
!-- coefficient input data and Planck fraction input data.
!-- Compute relative weighting for new g-point combinations.

IGCSM = 0
DO IBND = 1,JPSW
  IPRSM = 0
  IF (NGC(IBND) < JPG) THEN
    DO IGC = 1,NGC(IBND)
      IGCSM = IGCSM + 1
      ZWTSUM = 0.
      DO IPR = 1, NGN(IGCSM)
        IPRSM = IPRSM + 1
        ZWTSUM = ZWTSUM + WT(IPRSM)
      ENDDO
      WTSM(IGC) = ZWTSUM
    ENDDO

    DO IG = 1,NG(IBND+15)
      IND = (IBND-1)*JPG + IG
      RWGT(IND) = WT(IG)/WTSM(NGM(IND))
    ENDDO
  ELSE
    DO IG = 1,NG(IBND+15)
      IGCSM = IGCSM + 1
      IND = (IBND-1)*JPG + IG
      RWGT(IND) = 1.0
    ENDDO
  ENDIF
ENDDO

CALL SRTM_CMBGB16
CALL SRTM_CMBGB17
CALL SRTM_CMBGB18
CALL SRTM_CMBGB19
CALL SRTM_CMBGB20
CALL SRTM_CMBGB21
CALL SRTM_CMBGB22
CALL SRTM_CMBGB23
CALL SRTM_CMBGB24
CALL SRTM_CMBGB25
CALL SRTM_CMBGB26
CALL SRTM_CMBGB27
CALL SRTM_CMBGB28
CALL SRTM_CMBGB29

!-----------------------------------------------------------------------
IF (LHOOK) CALL DR_HOOK('SRTM_INIT',1,ZHOOK_HANDLE)
END SUBROUTINE SRTM_INIT

